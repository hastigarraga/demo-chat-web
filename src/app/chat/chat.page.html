<div class="shell">
  <aside class="sidebar">
    <div class="side-header">
      <h3>Conversaciones</h3>
      <div class="side-actions">
        <button type="button" class="btn-new" (click)="newThread()">Nuevo</button>
        <button type="button" class="btn-logout" (click)="logout()">Salir</button>
      </div>
    </div>

    <div class="threads-scroll">
      <ul class="threads">
        <li *ngFor="let t of threads; trackBy: trackByIdx"
            [class.active]="(t._id||t.id) === (current?._id || current?.id)"
            (click)="select(t)">
          <div class="t-title">{{ titleOf(t) }}</div>
          <div class="t-meta">{{ (t.updatedAt || t.createdAt) | localTz:'dd/MM/yyyy HH:mm' }}</div>
          <div class="t-actions">
            <button type="button" class="btn-mini" (click)="renameThread(t); $event.stopPropagation()">Renombrar</button>
            <button type="button" class="btn-mini" (click)="removeThread(t); $event.stopPropagation()">Borrar</button>
          </div>
        </li>
      </ul>
    </div>
  </aside>

  <section class="main">
    <div class="messages" id="messages">
      <div *ngFor="let m of messages; trackBy: trackByIdx"
           class="msg"
           [class.user]="m.role==='user'"
           [class.assistant]="m.role==='assistant'">
        <div class="bubble">{{ m.content }}</div>
      </div>
      <div #bottom></div>
    </div>

    <div class="composer">
      <input type="text"
             [(ngModel)]="input"
             (keydown.enter)="send(); $event.preventDefault()"
             placeholder="Escribe tu mensajeâ€¦" />
      <button type="button" (click)="send()" [disabled]="sending">Enviar</button>
    </div>
  </section>
</div>
