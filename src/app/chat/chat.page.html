<div class="chat-layout">
  <aside class="sidebar">
    <div class="sidebar-header">
      <h3>Conversaciones</h3>
      <button class="btn new" (click)="newThread()">Nuevo</button>
    </div>
    <ul class="threads">
      <li *ngFor="let t of threads"
          [class.active]="(t._id || t.id) === (current?._id || current?.id)"
          (click)="select(t)">
        <div class="title">{{ t.title || ('Thread ' + (t._id || t.id)) }}</div>
        <div class="meta">{{ (t.updatedAt || t.createdAt) | date:'short' }}</div>
        <div class="row-actions">
          <button class="btn sm" (click)="$event.stopPropagation(); renameThread(t)">Renombrar</button>
          <button class="btn sm" (click)="$event.stopPropagation(); removeThread(t)">Borrar</button>
        </div>
      </li>
    </ul>
  </aside>

  <section class="chat">
    <div class="messages">
      <div class="empty" *ngIf="!messages?.length">Sin mensajes. Escribí abajo.</div>
      <div class="msg" *ngFor="let m of messages; trackBy: trackByIdx">
        <div class="role">{{ m.role }}</div>
        <div class="content">{{ m.content }}</div>
      </div>
      <div #bottom></div>
    </div>

    <div class="composer">
      <input type="text"
             placeholder="Escribe tu mensaje…"
             [(ngModel)]="input"
             (keydown.enter)="send()"/>
      <button class="btn send" (click)="send()" [disabled]="sending">Enviar</button>
    </div>
  </section>
</div>
