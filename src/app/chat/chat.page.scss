:host { display:block; height:100dvh; overflow:hidden; --account-h: 41px; }

/* evita que las columnas crezcan y bloqueen el scroll interno */
.shell > * { min-height:0; }

/* ===== Layout base ===== */
.shell{
  height:100dvh;
  display:grid;
  grid-template-columns:320px 1fr;
  gap:0;
  position:relative;
}

/* estado colapsado: sin columna fantasma */
.shell.collapsed{ grid-template-columns:1fr !important; }
.shell.collapsed .sidebar{
  position:absolute; left:0; top:0; bottom:0;
  width:0; overflow:hidden; border:0; padding:0;
}

.sidebar{
  height:100dvh;
  border-right:1px solid #1d2230;
  display:flex; flex-direction:column;
  min-width:0;
}
.side-header{ display:flex; align-items:center; justify-content:space-between; padding:12px 14px; }
.side-actions{ display:flex; gap:8px; align-items:center; width:100% }
.btn-new{ padding:6px 10px; border-radius:8px; border:1px solid #2a3346; background:#0b0e13; color:#dbe7f6; cursor:pointer; }
/* botón para ocultar sidebar */
.btn-hide{ padding:6px 8px; margin-left:auto; border-radius:8px; border:1px solid #2a3346; background:#0b0e13; color:#9fb0c8; cursor:pointer; }
.btn-hide:hover{ background:#121826; color:#e7edf6; }

.threads-scroll{ flex:1 1 auto; overflow:auto; padding:8px 12px 16px; }
.threads{ list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:10px; }
.threads>li{
  border:1px solid #1d2230; border-radius:12px;
  padding:10px 40px 10px 10px;
  background:#0f1218; cursor:pointer;
  position:relative;
}
.threads>li.active{ border-color:#355fff; }
.t-title{ font-weight:600; color:#e7edf6; }
.t-meta{ font-size:12px; color:#9fb0c8; margin-top:2px; }

/* botón tres puntitos — a la derecha y visible solo en hover de mouse */
.btn-ellipsis{
  position:absolute; top:50%; right:8px; transform:translateY(-50%);
  width:28px; height:28px; line-height:26px; text-align:center;
  border:none; border-radius:6px;
  background:transparent; color:#9fb0c8; cursor:pointer;
  opacity:0; pointer-events:none; transition:opacity .12s ease;
}
.threads>li:hover .btn-ellipsis,
.threads>li.active .btn-ellipsis{ opacity:1; pointer-events:auto; }
.btn-ellipsis:hover{ background:#1d2230; color:#e7edf6; }

/* Menú contextual FIXED (fuera del sidebar, sobre el chat) */
.ctx-menu{
  position:fixed;
  min-width:220px;
  background:#0f1218;
  border:1px solid #1d2230;
  box-shadow:0 8px 24px rgba(0,0,0,.45);
  border-radius:10px;
  padding:6px;
  z-index:1000;
}
.mi{ width:100%; display:block; padding:8px 10px; background:transparent; border:none; border-radius:8px; color:#e7edf6; text-align:left; cursor:pointer; }
.mi:hover{ background:#1a2232; }
.mi.danger{ color:#f87171; }
.mi.danger:hover{ background:#3b1f1f; }

/* ===== Columna chat ===== */
.main{ display:grid; grid-template-rows:1fr auto; min-width:0; min-height:0; }
.messages{
  flex:1 1 auto;
  overflow:auto;
  padding:16px 18px;
  scroll-behavior:smooth;
  background:#0a0d12;
}
.msg{ margin:0 0 14px; display:flex; }
.msg.user{ justify-content:flex-end; }
.bubble{
  max-width:min(900px, 100%);
  line-height:1.45; padding:10px 12px; border-radius:12px; border:1px solid #1d2230; background:#0f1218; color:#e7edf6;
}
.msg.user .bubble{ background:#0d1724; border-color:#1f2a3d; }

.composer{
  flex:0 0 auto;
  display:flex; gap:10px;
  padding:12px 14px;
  border-top:1px solid #1d2230;
  background:#0f1218;
  position:sticky; bottom:0;
}
.composer input{
  flex:1 1 auto; min-width:0; border:1px solid #2a3346; background:#0b0e13; color:#e7edf6; border-radius:10px; padding:12px 14px; outline:none;
}
.composer input:focus{ border-color:#355fff; }
.composer button{ padding:10px 14px; border-radius:10px; border:0; background:#2d56ff; color:#fff; font-weight:600; cursor:pointer; }
.composer button[disabled]{ opacity:.6; cursor:default; }

/* Ocultar barras de scroll */
.messages, .threads-scroll{ overflow:auto; scrollbar-width:none; -ms-overflow-style:none; }
.messages::-webkit-scrollbar, .threads-scroll::-webkit-scrollbar{ width:0; height:0; display:none; }

/* Bloque cuenta abajo */
.account{
  margin-top:auto; padding:12px; border-top:1px solid #1d2230; min-height:var(--account-h);
  display:flex; align-items:center; gap:10px; cursor:pointer; position:relative;
}
.account:hover{ background:#121826; }
.account .avatar{
  width:28px; height:28px; border-radius:50%; background:#1a2232;
  display:flex; align-items:center; justify-content:center; font-weight:600; color:#e7edf6;
}
.account .who .name{ font-size:13px; color:#e7edf6; line-height:1.1; }
.account .who .email{ font-size:12px; color:#9fb0c8; }
.account .chev{ margin-left:auto; color:#9fb0c8; }

/* Popover chico, no barra completa */
.account-menu{
  position:absolute;
  left:12px;
  bottom:56px;
  width:220px;
  background:#0f1218; border:1px solid #1d2230; box-shadow:0 8px 24px rgba(0,0,0,.45);
  border-radius:10px; padding:6px; z-index:1000;
}
.account-menu .mi{
  width:100%; display:block; padding:8px 10px; background:transparent;
  border:none; border-radius:8px; color:#e7edf6; text-align:left; cursor:pointer;
}

/* botón flotante para reabrir sidebar */
.toggle-sidebar{
  position:fixed; left:10px; top:10px; z-index:1001;
  border:1px solid #2a3346; background:#0b0e13; color:#e7edf6;
  padding:8px 10px; border-radius:10px; cursor:pointer;
}
.toggle-sidebar:hover{ background:#121826; }

/* ===== Mobile: overlay + ocultamiento real ===== */
@media (max-width: 768px){
  .shell{ grid-template-columns:1fr; }

  .sidebar{
    position:absolute; z-index:30; left:0; top:0; bottom:0;
    width:clamp(256px, 80vw, 340px);
    background:#0f1218; border-right:1px solid #1d2230;

    transform:translateX(0); opacity:1; visibility:visible;
    transition:transform .22s ease, opacity .18s ease, visibility .18s step-end;
    will-change:transform;
  }

  .shell.collapsed .sidebar{
    transform:translateX(-102%);
    opacity:0; visibility:hidden; pointer-events:none;
    transition:transform .22s ease, opacity .14s ease, visibility 0s .22s step-start;
  }

  /* burbujas al 100% en móvil */
  .bubble{ max-width:100%; }
}

/* mostrar los 3 puntos solo con mouse */
@media (pointer:fine){
  .btn-ellipsis{ opacity:0; transition:opacity .15s ease; }
  .thread:hover .btn-ellipsis{ opacity:1; }
}
